###### SETUP ######

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

autoload -Uz compinit && compinit

export ZDOTDIR={{ .chezmoi.homeDir }}/.config/zsh

# Setup & Source Antidote:
[[ -e ${ZDOTDIR:-~}/.antidote ]] ||
  git clone https://github.com/mattmc3/antidote.git ${ZDOTDIR:-~}/.antidote
source ${ZDOTDIR:-~}/.antidote/antidote.zsh
source <(antidote init)

antidote bundle ohmyzsh/ohmyzsh path:lib
antidote bundle ohmyzsh/ohmyzsh path:plugins/git
antidote bundle ohmyzsh/ohmyzsh path:plugins/asdf
antidote bundle Aloxaf/fzf-tab
antidote bundle zsh-users/zsh-syntax-highlighting
antidote bundle zsh-users/zsh-autosuggestions
antidote bundle Tarrasch/zsh-autoenv
antidote bundle Tarrasch/zsh-bd
antidote bundle agkozak/zsh-z
antidote bundle romkatv/powerlevel10k

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

export PATH="${PATH}:${HOME}/.krew/bin:${HOME}/bin"

bindkey -v
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_OPS="--extended"
export FZF_DEFAULT_COMMAND="fd --type f"
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
enable-fzf-tab

export EDITOR="$(which nvim)"

###### LANGUAGES ######

# ghcup-env
[ -f "{{ .chezmoi.homeDir }}/.ghcup/env" ] && source "{{ .chezmoi.homeDir }}/.ghcup/env"

# python/poetry
export POETRY_VIRTUALENVS_IN_PROJECT=true

###### HOOKS ######
eval "$(direnv hook zsh)"
export DIRENV_LOG_FORMAT=

export AUTOENV_FILE_LEAVE=.autoenv.zsh

###### KEYBINDS ######
bindkey -M viins '^j' fzf-cd-widget

# source any funcs & aliases
fpath=( "${HOME}/.config/zsh/functions" "${fpath[@]}" )
autoload -Uz $fpath[1]/*(.:t)
source "${HOME}/.config/zsh/aliases"
